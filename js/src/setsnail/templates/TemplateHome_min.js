function TemplateHome(data){function snapToStory(){easeToStory(getCurrentIndex())}function getCurrentIndex(){var scrollX=Assets.SCROLL_CONTROLLER.currentScroll.y,storyX=_storyModule.aniGetX(),numOfStories=_storyModule.getNumOfStories(),ratio=scrollX/storyX/numOfStories,partRatio=1/numOfStories;return Math.round(ratio/partRatio)}function easeToStory(storyIndex,speed){speed=null!=speed?speed:.4;var storyWidth=_storyModule.getExpandedStoryWidth();Assets.SCROLL_CONTROLLER.scrollTo(storyWidth*storyIndex,speed,Expo.easeInOut)}function setupAndAddModules(){var frontpageData=ContentManager.getChildByAttr(data.getXML(),"name","frontpage"),storyData=ContentManager.getChildByAttr(data.getXML(),"name","stories"),homeStartOffset=.5;BrowserDetect.TABLET?homeStartOffset=.6:BrowserDetect.MOBILE&&(homeStartOffset=1),_basicModule=new BasicHomeModule(frontpageData,onNextClick,homeStartOffset),_storyModule=new HomeStoryModule(storyData,homeStartOffset,_useCollapse),_storyModule.onStoryClick=onStoryClick,_useCollapse?(_returnModule=new ReturnModule(.5*(Assets.RESIZE_MANAGER.getWindowWidth()-SiteGuides.MAIN_MENU_WIDTH)+SiteGuides.MAIN_MENU_WIDTH),_instance.ignoreScrollAfter(.5*(Assets.RESIZE_MANAGER.getWindowWidth()-SiteGuides.MAIN_MENU_WIDTH)+SiteGuides.MAIN_MENU_WIDTH-120)):_returnModule=new ReturnModule,_returnModule.addLine(UIColors.LINE_ON_WHITE),_instance.addModule(_basicModule),_instance.addModule(_storyModule),_instance.addModule(_returnModule)}function onNextClick(){_instance.scrollToNextModule()}function onStoryClick(storyNumber){easeToStory(storyNumber,1)}var _instance=Snail.extend(new PageTemplate(data));_instance.style.backgroundColor=UIColors.WHITE;var _storyModule,_basicModule,_returnModule,_useCollapse=BrowserDetect.DESKTOP;return _instance.init=function(){_instance.super.init(),setupAndAddModules(),Assets.SCROLL_CONTROLLER.addEventListener(ScrollController.ON_SCROLL_EASE_STOP,snapToStory),_instance.onResize()},_instance.scrollToNextModule=function(){easeToStory(getCurrentIndex()+1,1)},_instance.scrollToPrevModule=function(){easeToStory(getCurrentIndex()-1,1)},_instance.templateIn=function(){_instance.init(),_instance.super.templateIn()},_instance.templateOut=function(){_instance.super.templateOut()},_instance.onResize=function(){_instance.super.onResize(),_useCollapse&&(_instance.ignoreScrollAfter(.5*(Assets.RESIZE_MANAGER.getWindowWidth()-SiteGuides.MAIN_MENU_WIDTH)+SiteGuides.MAIN_MENU_WIDTH-120),_returnModule.setWidth(.5*_instance.visibleWidth+SiteGuides.MAIN_MENU_WIDTH)),_instance.repositionModules(_returnModule),snapToStory()},_instance.kill=function(){Assets.SCROLL_CONTROLLER.removeEventListener(ScrollController.ON_SCROLL_EASE_STOP,snapToStory),_instance.super.kill()},_instance}