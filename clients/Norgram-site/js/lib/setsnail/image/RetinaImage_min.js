function RetinaImage(src,retinaHandle,callbackLoad,callbackError){function updateSize(){if(_isLoaded){if("insideBox"===_resizeMode){var ratio=_originalHeight/_originalWidth,areaRatio=_newH/_newW;ratio>areaRatio?(_image.width=_newW,_image.height=_newW*ratio):(ratio=_originalWidth/_originalHeight,_image.height=_newH,_image.width=_newH*ratio)}else if("auto"===_newW){if(null!==_newH){var ratio=_originalWidth/_originalHeight;_image.height=_newH,_image.width=_newH*ratio}}else if("auto"===_newH){if(null!==_newW){var ratio=_originalHeight/_originalWidth;_image.width=_newW,_image.height=_newW*ratio}}else null!==_newW&&(_image.width=_newW),null!==_newH&&(_image.heigth=_newH);_instance.style.width=_midContainer.style.width=_newW+"px",_instance.style.height=_midContainer.style.height=_newH+"px",updatePosition()}}function updatePosition(){if(_isLoaded){var x=0,y=0;"center/center"===_position&&(x=.5,y=.5),_image.style.left=_newW*x-_image.width*x+"px",_image.style.top=_newH*y-_image.height*y+"px"}}function loadResolutionSpecificImage(){_image&&(_midContainer.removeChild(_image),_instance.removeChild(_midContainer),_image=null);var loadPath=_src;if(null!==_retinaHandle){var imagePathArr=_src.split("."),lastPart=imagePathArr.pop();loadPath=imagePathArr.join(".")+_retinaHandle.getAssetScaleStr()+"."+lastPart}_image=new Image,_image.style.visibility="hidden",_image.style.position="absolute",_midContainer.style.position="absolute",_midContainer.appendChild(_image),_instance.appendChild(_midContainer),_image.addEventListener("load",onImageLoaded),_image.addEventListener("error",onImageError),_image.src=loadPath}function onImageError(){return doCallback(_callbackError),!0}function onImageLoaded(){_image.removeEventListener("load",onImageLoaded),_image.removeEventListener("error",onImageError);var scalePercent=_retinaHandle?_retinaHandle.getAssetScalePercent():1;_originalWidth=_image.width*scalePercent,_originalHeight=_image.height*scalePercent,_image.width=_originalWidth,_image.height=_originalHeight,_isLoaded=!0,updateSize(),_image.style.visibility="visible",doCallback(_callbackLoad)}function doCallback(callback){null!==callback&&(callback.length?callback(_instance):callback(),callback=null)}var _instance=document.createElement("div");_instance.style.position="absolute";var _image,_src=src,_retinaHandle=retinaHandle?retinaHandle:null,_midContainer=document.createElement("div"),_originalWidth=0,_originalHeight=0,_newW=null,_newH=null,_isLoaded=!1,_resizeMode="",_callbackLoad=callbackLoad?callbackLoad:null,_callbackError=callbackError?callbackError:null,_position="";return _instance.init=function(){loadResolutionSpecificImage(),null!==_retinaHandle&&_retinaHandle.addEventListener(RetinaHandleEvents.CHANGE,loadResolutionSpecificImage)},_instance.kill=function(){null!==_retinaHandle&&_retinaHandle.removeEventListener(RetinaHandleEvents.CHANGE,loadResolutionSpecificImage)},_instance.getWidth=function(){return _isLoaded?_image.width:0},_instance.getHeight=function(){return _isLoaded?_image.height:0},_instance.setSize=function(width,height){_newW=width,_newH=height,updateSize()},_instance.setWidth=function(val){_newW=val,updateSize()},_instance.setHeight=function(val){_newH=val,updateSize()},_instance.setResizeMode=function(mode){_resizeMode=mode,_midContainer.style.overflow="insideBox"===_resizeMode?"hidden":"visible",updateSize()},_instance.getContent=function(){return _image},_instance.setPosition=function(value){_position=value,updatePosition()},_instance.getOriginalWidth=function(){return _isLoaded?_originalWidth:0},_instance.getOriginalHeight=function(){return _isLoaded?_originalHeight:0},_instance.getWidthRatio=function(){return _isLoaded?_instance.getOriginalHeight()/_instance.getOriginalWidth():0},_instance.isLoaded=function(){return _isLoaded},_instance}